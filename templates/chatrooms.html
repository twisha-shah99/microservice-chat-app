{% extends "base.html" %}

{% block content %}
<h1>Chatrooms</h1>
<a href="{{ url_for('create_chatroom') }}" class="create-chatroom-button">+ Create New Chatroom</a>

<!-- Success Message -->
<div id="success-message" class="success-popup">
  <p>You have successfully joined the chatroom!</p>
  <a href="#" class="close-popup">Close</a>
</div>

<ul class="chatroom-list">
  {% for room in rooms %}
  <li class="chatroom-item">
    <div class="chatroom-info">
        <a href="/chatroom/{{ room.chatroom_id }}" class="chatroom-name">{{ room.chatroom_name }}</a>
    </div>
      {% set member_ids = room.chatroom_members | map(attribute='profile_id') | list %}
      {% if session['user_id'] in member_ids %}
          <!-- User is already a member -->
          <form action="{{ url_for('leave_chatroom', room_id=room.chatroom_id) }}" method="post" style="display:inline;">
              <button type="submit" class="leave-button">Leave</button>
          </form>
      {% else %}
          <!-- User is not a member -->
          
        <form action="{{ url_for('join_chatroom', room_id=room.chatroom_id) }}#success-message" method="post" style="display:inline;">
            <button type="submit" class="join-button">Join</button>
        </form>
      {% endif %}
  </li>
{% endfor %}
</ul>
{% endblock %}
